<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‰å›½ï¼šå±±æ²³ç»˜å· (Debugç‰ˆ)</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #1e1e1e;
            font-family: 'Microsoft YaHei', sans-serif;
            color: white;
            user-select: none;
        }

        /* UI å±‚ */
        #ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
        }

        /* é¡¶éƒ¨èµ„æºæ  */
        .top-bar {
            position: absolute;
            top: 0; left: 0; width: 100%;
            background: rgba(0,0,0,0.8);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            box-sizing: border-box;
            border-bottom: 2px solid #c0392b;
            pointer-events: auto;
        }

        .res-group { display: flex; gap: 20px; font-size: 1.1em; font-weight: bold; align-items: center;}
        .res-gold { color: #f1c40f; }
        .res-pop { color: #2ecc71; }

        /* è°ƒè¯•é¢æ¿ */
        .debug-panel {
            position: absolute;
            top: 60px; right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #f1c40f;
            padding: 10px;
            border-radius: 5px;
            pointer-events: auto;
            display: flex;
            flex-direction: column;
            gap: 5px;
            z-index: 999;
        }
        .debug-title { color: #f1c40f; font-size: 0.8em; font-weight: bold; text-align: center; margin-bottom: 5px; }
        .debug-btn {
            background: #444;
            color: #fff;
            border: 1px solid #666;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.9em;
            transition: 0.2s;
        }
        .debug-btn:hover { background: #666; }
        .debug-btn:active { background: #f1c40f; color: black; }

        /* åº•éƒ¨ä¿¡æ¯æ  */
        .bottom-panel {
            position: absolute;
            bottom: 0; left: 0; width: 100%;
            height: 150px;
            background: linear-gradient(to top, rgba(0,0,0,1), rgba(0,0,0,0));
            pointer-events: none;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding-bottom: 20px;
        }

        .city-panel {
            background: rgba(20, 20, 20, 0.9);
            border: 1px solid #555;
            border-radius: 8px;
            padding: 15px;
            width: 400px;
            pointer-events: auto;
            display: none;
            text-align: center;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
        }

        .city-title { font-size: 1.5em; margin-bottom: 10px; color: #ecf0f1; border-bottom: 1px solid #444; padding-bottom: 5px; }
        .action-btn {
            background: #c0392b;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
            transition: 0.2s;
        }
        .action-btn:hover { background: #e74c3c; transform: scale(1.05); }
        .action-btn:disabled { background: #555; cursor: not-allowed; transform: none; }

        /* æµ®åŠ¨æ—¥å¿— */
        #log-container {
            position: absolute;
            bottom: 160px;
            left: 20px;
            width: 300px;
            height: 200px;
            overflow: hidden;
            pointer-events: none;
            display: flex;
            flex-direction: column-reverse;
        }
        .log-msg {
            background: rgba(0,0,0,0.5);
            color: #ddd;
            padding: 4px 8px;
            margin-bottom: 4px;
            border-radius: 4px;
            font-size: 0.9em;
            animation: fadeOut 10s forwards;
        }
        .log-debug { color: #f1c40f; font-weight: bold; }
        @keyframes fadeOut { 0% {opacity:1;} 80% {opacity:1;} 100% {opacity:0;} }

        /* æ•™ç¨‹é®ç½© */
        #tutorial {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            pointer-events: auto;
            text-align: center;
        }
        #start-btn {
            margin-top: 30px; padding: 15px 40px; font-size: 1.5em;
            background: #c0392b; color: white; border: 2px solid #e74c3c; border-radius: 50px; cursor: pointer;
        }
        #start-btn:hover { background: #e74c3c; }

    </style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<div id="ui-layer">
    <div class="top-bar">
        <div class="res-group" style="color: #e74c3c">
            <span>åŠ¿åŠ›: åˆ˜å¤‡ (èœ€)</span>
        </div>
        <div class="res-group">
            <span class="res-gold">ğŸ’° <span id="total-gold">0</span></span>
            <span class="res-pop">âš”ï¸ <span id="total-troops">0</span></span>
        </div>
        <div class="res-group" style="color: #aaa">
            <span id="game-time">å…¬å…ƒ 190 å¹´ 1 æœˆ</span>
        </div>
    </div>

    <div class="debug-panel">
        <div class="debug-title">ğŸ› ï¸ å¼€å‘è€…æŒ‡ä»¤</div>
        <button class="debug-btn" onclick="game.debugAddGold()">ğŸ’° å¢åŠ  100 é»„é‡‘</button>
        <button class="debug-btn" onclick="game.debugAddTroops()">âš”ï¸ å¢åŠ  100 å…µåŠ›</button>
        <button class="debug-btn" onclick="game.debugClearFog()" style="color:#aaa; font-size:0.8em;">(æç¤º:å…µåŠ›éœ€é€‰ä¸­åŸæ± )</button>
    </div>

    <div id="log-container"></div>

    <div class="bottom-panel">
        <div class="city-panel" id="city-panel">
            <div class="city-title" id="cp-name">æ´›é˜³</div>
            <div style="display:flex; justify-content:space-around; margin-bottom:10px;">
                <div>å®ˆå†›: <span id="cp-troops" style="color:#e74c3c; font-weight:bold;">0</span></div>
                <div>äº§å‡º: <span id="cp-income" style="color:#f1c40f">0</span>/ç§’</div>
                <div>ç­‰çº§: <span id="cp-level">1</span></div>
            </div>
            <div>
                <button class="action-btn" id="btn-upgrade" onclick="game.upgradeCity()">ğŸ° æ‰©å»º (-200é‡‘)</button>
                <button class="action-btn" id="btn-draft" onclick="game.draftSoldiers()">âš”ï¸ å¾å…µ (-50é‡‘)</button>
            </div>
            <div style="font-size:0.8em; color:#888; margin-top:5px;">
                æç¤ºï¼šæ‹–æ‹½åŸæ± è¿çº¿å³å¯å‡ºå…µ
            </div>
        </div>
    </div>
</div>

<div id="tutorial">
    <h1 style="color:#c0392b; font-size:3em; margin-bottom:10px;">ä¸‰å›½ï¼šå±±æ²³ç»˜å·</h1>
    <p style="color:#ccc; font-size:1.2em;">
        æ‹–æ‹½åŸæ±  -> è¿æ¥æ•ŒåŸ -> å‡ºå…µå¾æœ<br>
        <span style="color:#f1c40f">å³ä¸Šè§’å·²å¼€å¯å¼€å‘è€…è°ƒè¯•æ¨¡å¼</span>
    </p>
    <button id="start-btn" onclick="game.start()">å¼€å§‹å¾æˆ˜</button>
</div>

<script>
    /* --- æ¸¸æˆæ ¸å¿ƒé€»è¾‘ --- */
    
    const FACTIONS = {
        NEUTRAL: { id: 0, color: '#7f8c8d', name: 'ä¸­ç«‹' },
        PLAYER:  { id: 1, color: '#e74c3c', name: 'åˆ˜å¤‡', bg: 'rgba(231, 76, 60, 0.2)' },
        CAO:     { id: 2, color: '#3498db', name: 'æ›¹æ“', bg: 'rgba(52, 152, 219, 0.2)' },
        SUN:     { id: 3, color: '#2ecc71', name: 'å­™æƒ', bg: 'rgba(46, 204, 113, 0.2)' }
    };

    const CITIES_DATA = [
        { id: 'beiping', name: 'åŒ—å¹³', x: 1200, y: 150, troops: 50 },
        { id: 'ye', name: 'é‚ºåŸ', x: 1100, y: 300, troops: 100 },
        { id: 'jinyang', name: 'æ™‹é˜³', x: 900, y: 250, troops: 60 },
        { id: 'luoyang', name: 'æ´›é˜³', x: 950, y: 450, troops: 200 },
        { id: 'xuchang', name: 'è®¸æ˜Œ', x: 1050, y: 500, troops: 150 },
        { id: 'changan', name: 'é•¿å®‰', x: 750, y: 450, troops: 180 },
        { id: 'wan', name: 'å®›åŸ', x: 900, y: 580, troops: 80 },
        { id: 'xiapi', name: 'ä¸‹é‚³', x: 1250, y: 500, troops: 100 },
        { id: 'shouchun', name: 'å¯¿æ˜¥', x: 1200, y: 600, troops: 100 },
        { id: 'jianye', name: 'å»ºä¸š', x: 1350, y: 700, troops: 150 },
        { id: 'hanzhong', name: 'æ±‰ä¸­', x: 600, y: 500, troops: 100 },
        { id: 'chengdu', name: 'æˆéƒ½', x: 500, y: 700, troops: 150 },
        { id: 'jingzhou', name: 'è†å·', x: 950, y: 700, troops: 150 },
        { id: 'changsha', name: 'é•¿æ²™', x: 1000, y: 850, troops: 80 },
        { id: 'chaiSang', name: 'æŸ´æ¡‘', x: 1150, y: 750, troops: 100 }
    ];

    const ROADS = [
        ['beiping', 'ye'], ['ye', 'jinyang'], ['ye', 'luoyang'], ['ye', 'xuchang'], ['ye', 'xiapi'],
        ['jinyang', 'luoyang'], ['jinyang', 'changan'], ['luoyang', 'changan'], ['luoyang', 'xuchang'], ['luoyang', 'wan'],
        ['changan', 'hanzhong'], ['changan', 'wan'], ['xuchang', 'xiapi'], ['xuchang', 'shouchun'], ['xuchang', 'wan'],
        ['xiapi', 'shouchun'], ['shouchun', 'jianye'], ['shouchun', 'wan'], ['shouchun', 'chaiSang'],
        ['jianye', 'chaiSang'], ['wan', 'jingzhou'], ['hanzhong', 'chengdu'], ['chengdu', 'jingzhou'],
        ['jingzhou', 'changsha'], ['jingzhou', 'chaiSang'], ['chaiSang', 'changsha']
    ];

    class City {
        constructor(data) {
            this.id = data.id;
            this.name = data.name;
            this.baseX = data.x;
            this.baseY = data.y;
            this.x = 0; this.y = 0;
            this.faction = FACTIONS.NEUTRAL;
            this.troops = data.troops;
            this.maxTroops = 500;
            this.level = 1;
            this.troopAccumulator = 0;

            if (this.id === 'chengdu') this.setFaction(FACTIONS.PLAYER);
            if (this.id === 'hanzhong') this.setFaction(FACTIONS.PLAYER);
            if (this.id === 'xuchang' || this.id === 'luoyang' || this.id === 'ye') this.setFaction(FACTIONS.CAO);
            if (this.id === 'jianye' || this.id === 'chaiSang') this.setFaction(FACTIONS.SUN);
        }

        setFaction(faction) {
            this.faction = faction;
            this.troops = Math.max(this.troops, 100);
        }

        update(dt) {
            if (this.faction === FACTIONS.NEUTRAL) return;
            const troopRate = 0.5 * this.level; 
            this.troopAccumulator += troopRate * dt;
            if (this.troopAccumulator >= 1) {
                const add = Math.floor(this.troopAccumulator);
                if (this.troops < this.maxTroops * this.level) {
                    this.troops += add;
                }
                this.troopAccumulator -= add;
            }
            if (this.faction === FACTIONS.PLAYER) {
                game.playerGold += 2 * this.level * dt;
            }
        }

        draw(ctx) {
            if (this.faction !== FACTIONS.NEUTRAL) {
                ctx.beginPath();
                ctx.arc(this.x, this.y, 40 + this.troops/20, 0, Math.PI * 2);
                ctx.fillStyle = this.faction.bg;
                ctx.fill();
            }
            if (game.selectedCity === this) {
                ctx.beginPath(); ctx.arc(this.x, this.y, 25, 0, Math.PI * 2);
                ctx.strokeStyle = "white"; ctx.lineWidth = 3; ctx.stroke();
            }
            ctx.beginPath(); ctx.arc(this.x, this.y, 15, 0, Math.PI * 2);
            ctx.fillStyle = this.faction.color; ctx.fill();
            ctx.strokeStyle = "#fff"; ctx.lineWidth = 2; ctx.stroke();

            ctx.fillStyle = "#fff"; ctx.font = "bold 14px Microsoft YaHei"; ctx.textAlign = "center";
            ctx.fillText(this.name, this.x, this.y - 25);
            
            ctx.fillStyle = "#000"; ctx.fillRect(this.x - 20, this.y + 20, 40, 6);
            ctx.fillStyle = this.faction.color;
            const pct = Math.min(1, this.troops / (this.maxTroops * this.level));
            ctx.fillRect(this.x - 20, this.y + 20, 40 * pct, 6);
            ctx.font = "10px Arial"; ctx.fillText(Math.floor(this.troops), this.x, this.y + 38);
        }
    }

    class Army {
        constructor(from, to, count, faction) {
            this.from = from; this.to = to; this.count = Math.floor(count); this.faction = faction;
            this.progress = 0; this.speed = 0.08; this.arrived = false;
        }
        update(dt) {
            this.progress += this.speed * dt;
            if (this.progress >= 1) { this.progress = 1; this.arrived = true; return true; }
            return false;
        }
        draw(ctx) {
            const dx = this.to.x - this.from.x; const dy = this.to.y - this.from.y;
            const cx = this.from.x + dx * this.progress; const cy = this.from.y + dy * this.progress;
            ctx.beginPath(); ctx.arc(cx, cy, 8, 0, Math.PI * 2);
            ctx.fillStyle = this.faction.color; ctx.fill();
            ctx.strokeStyle = "white"; ctx.lineWidth = 1; ctx.stroke();
            ctx.fillStyle = "white"; ctx.font = "10px Arial"; ctx.fillText(this.count, cx, cy - 12);
        }
    }

    const game = {
        canvas: document.getElementById('gameCanvas'),
        ctx: document.getElementById('gameCanvas').getContext('2d'),
        cities: [], armies: [],
        scaleX: 1, scaleY: 1, lastTime: 0,
        playerGold: 500,
        selectedCity: null,
        isDragging: false, dragStartCity: null, dragX: 0, dragY: 0,
        isPlaying: false, timeElapsed: 0, aiTimer: 0,

        init: function() {
            this.resize();
            window.addEventListener('resize', () => this.resize());
            CITIES_DATA.forEach(data => this.cities.push(new City(data)));
            this.updateCityPositions();
            this.canvas.addEventListener('mousedown', e => this.onMouseDown(e));
            this.canvas.addEventListener('mousemove', e => this.onMouseMove(e));
            this.canvas.addEventListener('mouseup', e => this.onMouseUp(e));
        },

        start: function() {
            document.getElementById('tutorial').style.display = 'none';
            this.isPlaying = true;
            this.lastTime = performance.now();
            requestAnimationFrame(t => this.loop(t));
            this.log("æ¸¸æˆå¼€å§‹ï¼ç›®æ ‡ï¼šç»Ÿä¸€å¤©ä¸‹");
        },

        loop: function(t) {
            if (!this.isPlaying) return;
            const dt = (t - this.lastTime) / 1000;
            this.lastTime = t;
            this.update(dt);
            this.draw();
            requestAnimationFrame(t => this.loop(t));
        },

        update: function(dt) {
            this.timeElapsed += dt;
            const totalMonths = Math.floor(this.timeElapsed / 2);
            const year = 190 + Math.floor(totalMonths / 12);
            const month = (totalMonths % 12) + 1;
            document.getElementById('game-time').innerText = `å…¬å…ƒ ${year} å¹´ ${month} æœˆ`;

            let pTroops = 0;
            this.cities.forEach(c => {
                c.update(dt);
                if (c.faction === FACTIONS.PLAYER) pTroops += c.troops;
            });
            document.getElementById('total-gold').innerText = Math.floor(this.playerGold);
            document.getElementById('total-troops').innerText = Math.floor(pTroops);
            
            if (this.selectedCity) {
                document.getElementById('cp-troops').innerText = Math.floor(this.selectedCity.troops);
                document.getElementById('cp-income').innerText = (2 * this.selectedCity.level);
                document.getElementById('cp-level').innerText = this.selectedCity.level;
                const upgradeCost = 200 * this.selectedCity.level;
                document.getElementById('btn-upgrade').innerText = `ğŸ° æ‰©å»º (-${upgradeCost}é‡‘)`;
                document.getElementById('btn-upgrade').disabled = this.playerGold < upgradeCost || this.selectedCity.faction !== FACTIONS.PLAYER;
                document.getElementById('btn-draft').disabled = this.playerGold < 50 || this.selectedCity.faction !== FACTIONS.PLAYER;
            }

            for (let i = this.armies.length - 1; i >= 0; i--) {
                if (this.armies[i].update(dt)) {
                    this.resolveBattle(this.armies[i]);
                    this.armies.splice(i, 1);
                }
            }

            this.aiTimer += dt;
            if (this.aiTimer > 2) { this.aiTimer = 0; this.runAI(); }
        },

        draw: function() {
            this.ctx.fillStyle = "#1e1e1e"; this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
            this.ctx.strokeStyle = "#444"; this.ctx.lineWidth = 2; this.ctx.beginPath();
            ROADS.forEach(pair => {
                const c1 = this.getCity(pair[0]); const c2 = this.getCity(pair[1]);
                if (c1 && c2) { this.ctx.moveTo(c1.x, c1.y); this.ctx.lineTo(c2.x, c2.y); }
            });
            this.ctx.stroke();
            if (this.isDragging && this.dragStartCity) {
                this.ctx.beginPath(); this.ctx.moveTo(this.dragStartCity.x, this.dragStartCity.y);
                this.ctx.lineTo(this.dragX, this.dragY);
                this.ctx.strokeStyle = "#fff"; this.ctx.setLineDash([5, 5]); this.ctx.stroke(); this.ctx.setLineDash([]);
            }
            this.cities.forEach(c => c.draw(this.ctx));
            this.armies.forEach(a => a.draw(this.ctx));
        },

        /* --- Debug åŠŸèƒ½ --- */
        debugAddGold: function() {
            this.playerGold += 100;
            this.log("ã€ä½œå¼Šã€‘å›½åº“å……ç›ˆï¼è·å¾— 100 é»„é‡‘", "debug");
        },
        debugAddTroops: function() {
            if (this.selectedCity) {
                this.selectedCity.troops += 100;
                this.log(`ã€ä½œå¼Šã€‘å¤©å…µé™ä¸´ï¼${this.selectedCity.name} å¢åŠ  100 å…µåŠ›`, "debug");
            } else {
                alert("è¯·å…ˆç”¨é¼ æ ‡ç‚¹å‡»é€‰æ‹©ä¸€åº§åŸæ± ï¼");
            }
        },
        debugClearFog: function() {
            // å ä½
        },

        /* --- å…¶ä»–é€»è¾‘ --- */
        resolveBattle: function(army) {
            const target = army.to;
            if (target.faction === army.faction) {
                target.troops += army.count;
                this.log(`${army.faction.name} å¢æ´ ${target.name} +${army.count}`);
            } else {
                const atk = army.count * (1 + Math.random() * 0.2);
                const def = target.troops * (1 + (target.level * 0.2));
                if (atk > def) {
                    const remain = Math.floor(atk - def);
                    target.setFaction(army.faction);
                    target.troops = remain;
                    target.level = Math.max(1, target.level - 1);
                    this.log(`ã€å¤§æ·ã€‘${army.faction.name} å é¢† ${target.name}ï¼`);
                    this.checkWin();
                } else {
                    target.troops -= Math.floor(atk * 0.8);
                    if (target.troops < 0) target.troops = 0;
                }
            }
        },

        runAI: function() {
            this.cities.forEach(city => {
                if (city.faction === FACTIONS.CAO || city.faction === FACTIONS.SUN) {
                    if (city.level < 3 && Math.random() < 0.05) city.level++;
                    if (city.troops > 150) {
                        const neighbors = this.getNeighbors(city);
                        let target = null;
                        neighbors.forEach(n => { if (n.faction !== city.faction && n.troops < city.troops * 0.8) target = n; });
                        if (!target && city.troops > 300) {
                            neighbors.forEach(n => { if (n.faction === city.faction && n.troops < 100) target = n; });
                        }
                        if (target) this.sendTroops(city, target);
                    }
                }
            });
        },

        onMouseDown: function(e) {
            const {x, y} = this.getMousePos(e);
            const city = this.getCityAt(x, y);
            if (city) {
                this.selectedCity = city;
                this.updatePanel(city);
                if (city.faction === FACTIONS.PLAYER) {
                    this.isDragging = true; this.dragStartCity = city; this.dragX = x; this.dragY = y;
                }
            } else {
                this.selectedCity = null;
                document.getElementById('city-panel').style.display = 'none';
            }
        },
        onMouseMove: function(e) {
            const {x, y} = this.getMousePos(e);
            this.dragX = x; this.dragY = y;
            if (this.getCityAt(x, y)) this.canvas.style.cursor = 'pointer';
            else this.canvas.style.cursor = 'default';
        },
        onMouseUp: function(e) {
            if (this.isDragging && this.dragStartCity) {
                const {x, y} = this.getMousePos(e);
                const targetCity = this.getCityAt(x, y);
                if (targetCity && targetCity !== this.dragStartCity && this.isConnected(this.dragStartCity, targetCity)) {
                    this.sendTroops(this.dragStartCity, targetCity);
                }
            }
            this.isDragging = false; this.dragStartCity = null;
        },

        sendTroops: function(from, to) {
            if (from.troops < 20) return;
            const amount = Math.floor(from.troops * 0.5);
            from.troops -= amount;
            this.armies.push(new Army(from, to, amount, from.faction));
        },
        upgradeCity: function() {
            if (!this.selectedCity) return;
            const cost = 200 * this.selectedCity.level;
            if (this.playerGold >= cost) {
                this.playerGold -= cost; this.selectedCity.level++;
                this.log(`${this.selectedCity.name} æ‰©å»ºå®Œæˆï¼`);
            }
        },
        draftSoldiers: function() {
            if (!this.selectedCity) return;
            if (this.playerGold >= 50) {
                this.playerGold -= 50; this.selectedCity.troops += 20;
                this.log(`å¾å…µå®Œæˆï¼`);
            }
        },

        resize: function() {
            this.canvas.width = window.innerWidth; this.canvas.height = window.innerHeight;
            this.scaleX = this.canvas.width / 1920; this.scaleY = this.canvas.height / 1080;
            this.updateCityPositions();
        },
        updateCityPositions: function() {
            this.cities.forEach(c => { c.x = c.baseX * this.scaleX; c.y = c.baseY * this.scaleY; });
        },
        getMousePos: function(e) {
            const rect = this.canvas.getBoundingClientRect();
            return { x: e.clientX - rect.left, y: e.clientY - rect.top };
        },
        getCity: function(id) { return this.cities.find(c => c.id === id); },
        getCityAt: function(x, y) { return this.cities.find(c => (c.x-x)**2 + (c.y-y)**2 < 900); },
        getNeighbors: function(city) {
            const neighbors = [];
            ROADS.forEach(pair => {
                if (pair[0] === city.id) neighbors.push(this.getCity(pair[1]));
                if (pair[1] === city.id) neighbors.push(this.getCity(pair[0]));
            }); return neighbors;
        },
        isConnected: function(c1, c2) {
            return ROADS.some(pair => (pair[0] === c1.id && pair[1] === c2.id) || (pair[0] === c2.id && pair[1] === c1.id));
        },
        updatePanel: function(city) {
            document.getElementById('city-panel').style.display = 'block';
            document.getElementById('cp-name').innerText = city.name;
        },
        log: function(msg, type) {
            const box = document.getElementById('log-container');
            const div = document.createElement('div');
            div.className = 'log-msg ' + (type === 'debug' ? 'log-debug' : '');
            div.innerText = msg;
            box.prepend(div);
        },
        checkWin: function() {
            const pCities = this.cities.filter(c => c.faction === FACTIONS.PLAYER).length;
            if (pCities === this.cities.length) { alert("å¤©ä¸‹ç»Ÿä¸€ï¼"); location.reload(); }
            else if (pCities === 0) { alert("è´¥å±€å·²å®š..."); location.reload(); }
        }
    };

    game.init();
</script>
</body>
</html>